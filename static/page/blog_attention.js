function ty_bbs_attention_load(){var t=location.href.length,n=location.href.lastIndexOf("/"),e=location.href.substr(n+1,t-n);e.indexOf("blog_main.asp")>-1&&jQuery("#midcontent").find("div.article-summary").each(ty_bbs_attention_action),e.indexOf("post_show.asp")>-1&&(jQuery("#vconArea").find("div.vcon").each(ty_bbs_attention_action),jQuery("#vconArea").find("div.rcon").each(ty_bbs_attention_action));var i="div.article",a="div.comments-content";jQuery("#right_bigcontent").find(i).each(ty_bbs_attention_action),jQuery("#right_bigcontent").find(a).each(ty_bbs_attention_action)}function ty_bbs_attention_action(t){for(var n=jQuery(this).html(),e=ty_bbs_attention(n),t=0;t<e.length;t++)n=n.replace("@"+e[t],"<a href=http://www.tianya.cn/name/"+encodeURIComponent(e[t])+" name="+ty_hashCode(e[t])+" class=post_msg target=_blank>@"+e[t]+"</a>");e.length>0&&jQuery(this).html(n)}function ty_bbs_attention(t){if(null==t||0==t.length)return o;var n=2e3,e=21,i=17,a=0,o=new Array,r=t;if(t.length>n&&(r=t.substring(0,n)),window.location.href.indexOf("water")&&(e=101),r.indexOf("@")>-1)for(var s,c,h,_,l,b,f=r.split("@"),u=f.length>e?e:f.length,y=1;u>y;y++){c=f[y].length>i?i:f[y].length,b=f[y].substring(0,c).split(""),h=c,_=0;for(var d=0;c>d;d++){if(l=b[d],"."==l){h=0;break}if(" "==l||"　"==l||","==l||"，"==l||"~"==l||"～"==l||"!"==l||"！"==l||"@"==l||"＠"==l||"#"==l||"＃"==l||"$"==l||"￥"==l||"%"==l||"％"==l||"^"==l||"…"==l||"&"==l||"＆"==l||"*"==l||"×"==l||"("==l||"（"==l||")"==l||"）"==l||"－"==l||"+"==l||"＋"==l||"="==l||"＝"==l||"["==l||"【"==l||"]"==l||"】"==l||"{"==l||"｛"==l||"}"==l||"｝"==l||":"==l||"："==l||";"==l||"；"==l||'"'==l||"“"==l||"”"==l||"'"==l||"＼"==l||","==l||"，"==l||"<"==l||"《"==l||">"==l||"》"==l||"。"==l||"?"==l||"？"==l||"/"==l||"、"==l||"|"==l||"｜"==l||"\\"==l||"＼"==l||"\n"==l||"\r"==l){h=d;break}if(_+=ty_isDoubleChar(l)?2:1,_>=i){h=0;break}}h>1&&(s=f[y].substring(0,h),null!=s&&s.length>0&&(o[a++]=s))}return o}function ty_isDoubleChar(t){return!/[x00-xff]/.test(t)}function ty_hashCode(t){for(var n=0,e=0,i=t.length,a=0;i>a;a++)n=31*n+t.charCodeAt(e++),(n>2147483647||2147483648>n)&&(n=4294967295&n);return n}