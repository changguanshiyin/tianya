TY.loadedModule("TY.util.cursorPoint"),function(){TY.prototype.selection=function(){var e,t,n,a,o;if(void 0==this[0].selectionStart){var r=document.selection;if("textarea"==this[0].tagName.toLowerCase())n=r.createRange(),a=n.duplicate(),a.moveToElementText(this[0]),a.setEndPoint("EndToEnd",n),e=a.text.length-n.text.length,t=e+n.text.length;else if("div"==this[0].tagName.toLowerCase()){n=document.selection.createRange();var i=n.parentElement(),c=document.body.createTextRange();for(c.moveToElementText(i),o=0;c.compareEndPoints("StartToStart",n)<0;o++)c.moveStart("character",1);document.getElementById("editDiv").innerText=i.innerText.substring(o-1,o)}else{var l=this.val();n=r.createRange().duplicate(),n.moveEnd("character",l.length),e=""==n.text?l.length:l.lastIndexOf(n.text),n=r.createRange().duplicate(),n.moveStart("character",-l.length),t=n.text.length}}else e=this[0].selectionStart,t=this[0].selectionEnd;var s=this[0].value.substring(e,t);return{start:e,end:t,text:s}}}(jQuery),function(){TY.namespace("TY.util.cursorPoint");var e=jQuery;TY.util.cursorPoint={rangeData:{text:"",start:0,end:0},get:function(t){var n=e(t).data("rangeData");return n||(n={text:"",start:0,end:0}),n},set:function(e,t){try{var n;t||alert("You must get cursor position first."),e.focus(),e.setSelectionRange?e.setSelectionRange(t.start,t.end):e.createTextRange&&(n=e.createTextRange(),+e.value.length===+t.start?(n.collapse(!1),n.select()):(n.moveToBookmark(t.bookmark),n.select()))}catch(a){"undefined"!=typeof console&&console.log(a)}},add:function(e,t,n){var a=e.value.substring(0,t.end),o=e.value.substring(t.end);e.value=a+n+o,this.toTextAt(e,e.value.length-o.length)},toTextEnd:function(e){if(document.all){var t=e.createTextRange();t.moveStart("character",e.value.length),t.collapse(!0),t.select()}else e.setSelectionRange(e.value.length,e.value.length),e.focus()},toTextAt:function(e,t){if(t?(t>e.value.length&&(t=e.value.length),0>t&&(t=0)):t=e.value.length,document.all){var n=e.createTextRange();n.moveStart("character",t),n.collapse(!0),n.select()}else e.setSelectionRange(t,t),e.focus()},bindCursorPoint:function(t){if(t){null==t.getAttribute("_cursorPoint")&&e(t).bind("select click focus change keyup",function(){e(t).data("rangeData",e(t).selection())}).attr("bindCursor",!0)}},selectTxt:function(e,t,n){try{if(!document.selection)return void e.setSelectionRange(t,t+n);var a=e.createTextRange();a.collapse(1),a.moveStart("character",t),a.moveEnd("character",n),a.select()}catch(o){TY.util.console({title:"选中文本",msg:o})}},init:function(){var t=this;e("textarea").livequery(function(){e(this).prop("bindCursor")||t.bindCursorPoint(this)}),e(":input[type=text]").livequery(function(){e(this).prop("bindCursor")||t.bindCursorPoint(this)})}},e(document).ready(function(){TY.util.cursorPoint.init()})}();