function CheckSubmit(t){var e=$.trim(t.comment.value);return""==e?(alert("内容不能为空!"),!1):""==t.validate_key.value?(alert("验证码不能为空！"),!1):!0}function bloggooglesubmit(){document.frm_google_ping.submit(),document.frm_soso_ping.submit()}function get_keycode(t){document.getElementById("imgcodeid")&&(document.getElementById("imgcodeid").innerHTML='<input name="validate_key" type="text"  id="validate_key" size="4" maxlength="4"/><img src=http://blog.tianya.cn/blogger/keycode/code.asp?id='+t+" height=18 align=absmiddle>"),window.navigator.userAgent.indexOf("Firefox")>=1?document.getElementById("validate_key").focus():document.frm_comment.validate_key.focus()}function SoundControl(t,e){var i=t;document.getElementById("SoundControl").innerHTML="play"==i?"<embed id=SoundControl src="+e+" autostart=true loop=-1 controls=ControlPanel width=0 height=0>":"<embed id=SoundControl src="+e+" autostart=true loop=true controls=ControlPanel width=0 height=0>"}function openwindow(t){return window.open(t,"","width=500,height=300,resizable=0,status=0,menubar=0,scrollbars=0"),!1}function del(){var t,e=!0,o="";if(t=document.form1.answer.length+""=="undefined"?1:document.form1.answer.length,1==t)document.form1.answer.checked&&(e=!1,o=document.form1.answer.value);else for(i=0;i<document.form1.answer.length;i++)document.form1.answer[i].checked&&(""==o?(e=!1,o=document.form1.answer[i].value):(e=!1,o=o+","+document.form1.answer[i].value));return e?alert("对不起,你还没有选择要删除的评论!"):confirm("警告:\n请确定是否真的要删除选中的评论!")&&(document.form1.action="http://blog.tianya.cn/webadmin/blog_deletecomment.jsp",this.document.form1.submit()),!e}function checkall(t){for(var e=document.getElementsByName("answer"),i=0;i<e.length;i++)e[i].checked=t.checked}function ConfirmDelete(){confirm("确定要进行轨迹清理?")&&form_del.submit()}function initAdvice(){var t={cssStr:[".ty_tip_box{position: absolute;width: 25px;}",".ty_tip_box .yijianfankui {display:block; width: 25px; height: 87px; overflow: hidden; background: url(http://static.tianyaui.com/global/lite/images/ico.png) no-repeat 0px -3030px; }"],init:function(){window.top==self&&this.detectUrl()&&(this.initDom(),this.bindEvent())},loadStyleString:function(t){var e=document.createElement("style");e.type="text/css";try{e.appendChild(document.createTextNode(t))}catch(i){e.styleSheet.cssText=t}var o=document.getElementsByTagName("head")[0];o.appendChild(e)},bindEvent:function(){var t=this;jQuery(".yijianfankui").click(function(t){"function"==typeof clickPartLink&&clickPartLink(t,"stat","新版顶导航/意见反馈")}),window.screen.availWidth>1024&&jQuery(window).resize(function(){var e=t.getPosition(),i=Math.max(document.documentElement.scrollWidth,document.documentElement.clientWidth);e&&e.left&&(e.left+25>i&&(e.left=i-25),jQuery(".ty_tip_box").css("left",e.left+"px").show())})},getPosition:function(){var t={},e=null,i=null,o=0,a=0;return e=jQuery("#blogwrapper"),0==e.size()?null:(i=e.offset(),t.top=jQuery("#blogheader").height()||0,window.screen.availWidth>1024?(o=i.left+parseInt(e.width(),10)+1,t.left=o+a):(t.right="0",t.left=null),t)},initDom:function(){var t=this.getPosition();if(t){this.loadStyleString(this.cssStr.join(""));var e=t.left?"left:"+t.left:"right:"+t.right;e+="px;";var i='<div class="ty_tip_box" style="top:'+t.top+"px;"+e+'">';i+='<a class="yijianfankui" title="谈谈新版感受和问题(无需登录)" href="http://bbs.tianya.cn/list-1018-1.shtml" target="_blank"></a>',i+="</div>",jQuery("body").append(i)}},detectUrl:function(){var t=document.location.href,e=/http:\/\/blog\.tianya\.cn\/blogger\/blog_main.asp\?BlogID=\d+/i,i=/http:\/\/blog\.tianya\.cn\/blogger\/post_read.asp\?BlogID=\d+&PostID=\d+/i;return e.test(t)||i.test(t)?!0:!1}};t.init()}function bindFocusFn(){TY_Twitter_util.prototype.delFollow||(TY_Twitter_util.prototype.delFollow=function(t,e){var i=this,o="delfocus_"+(new Date).getTime();jQuery.getScript("http://www.tianya.cn/api/tw?"+jQuery.param({"var":o,method:"following.ice.delete","params.followingUserId":t}),function(){var a=window[o]||{};if(1==a.success){for(var n=0;n<i.FollowList.length;n++)if(i.FollowList[n]==t){i.FollowList.splice(n,1);break}TY_Common_util.showTips("success","取消关注成功")}else TY_Common_util.showTips("warn","取消关注失败");e(a.data)})});var t=new TY_Twitter_util;jQuery(".actionBox").click(function(e){if(__global.isOnline()){var i=jQuery(e.target);i.hasClass("t-notfocus")?t.addFollow(i.attr("_data"),function(){i.removeClass("t-notfocus").addClass("t-focused")}):i.hasClass("t-focused")&&t.delFollow(i.attr("_data"),function(){i.removeClass("t-focused").addClass("t-notfocus")})}else TY.loginAction()}),t.getAllfollow(function(){jQuery(".t-notfocus").each(function(e,i){var o=jQuery(i),a=t.FollowList;-1!==jQuery.inArray(parseInt(o.attr("_data"),10),a)&&o.removeClass("t-notfocus").addClass("t-focused")})})}function bindSendMsg(){jQuery(".js-sendMsg").click(function(t){if(t.preventDefault(),__global.isOnline()){var e=jQuery(this).attr("uid"),i=jQuery(this).attr("uname");Qing_sendMessage(e,decodeURIComponent(i))}else TY.loginAction()})}function sendMessageAction(t,e,i,o,a,n){o||(o=__global.getUserId()),a||(a=__global.getUserName()),n||(n="天涯博客"),new TY.util.proxy({name:"tianyacnProxy",path:"http://www.tianya.cn/proxy.html"},"ajax",{url:"http://www.tianya.cn/api/msg?method=messageuser.insertmessage",data:{"params.sendUserId":o,"params.sendUserName":a,"params.receiveUserId":t,"params.receiveUserName":e,"params.content":i,"params.sourceName":n},type:"post",dataType:"json",success:function(t){1===+t.success?TY.loader("TY.ui.tips",function(){new TY.ui.tips({type:"success",msg:t.message||"消息发送成功",position:"midCenter",time:2500})}):TY.loader("TY.ui.tips",function(){new TY.ui.tips({type:"warn",msg:t.message||"消息发送失败",position:"midCenter",time:2500})})}})}function Qing_sendMessage(t,e){var i=[];i.push('<table width="320" height="120">'),i.push("	<tr>"),i.push('		<td valign="top" align="left" width="60">收信人:</td>'),i.push("		<td>"+e+"</td>"),i.push("	</tr>"),i.push("	<tr>"),i.push('		<td valign="top" align="left">内容:</td>'),i.push('		<td><textarea style="width:100%;height:80px;" id="Qing_message_content"></textarea></td>'),i.push("	</tr>"),i.push("</table>"),TY.loader("TY.ui.pop",function(){var o=new TY.ui.pop({headTxt:"短信息",body:i.join(""),type:"confirm",yesHandler:function(){var i=$("#Qing_message_content").val().trim();i?(sendMessageAction(t,e,i),o.remove()):alert("请填写消息内容")}})})}function setFloatMenu(){$("body").append(['<div id="flat_menu" class="bbs-flat-menu">','<div class="scroll-btn"><a href="javascript:scroll(0, 0);" class="s-btn scroll-top-btn js-scroll-top-btn"></a><a href="#fabu_anchor" class="s-btn toreply-btn js-toreply-btn"></a></div>',"</div>"].join(""));var t=$("#flat_menu"),e=$("#blogwrapper"),i=0,o=0,a=0,n=$.browser.msie&&"6.0"===$.browser.version?!0:!1,s=n?"absolute":"fixed",r=function(){i=$(window).width(),o=e.outerWidth(),a=t.outerWidth(),dScrollTopHeight=t.outerHeight();var r=Math.max($(document).height()-e.offset().top-e.outerHeight()-30,0);t.css(i>o+2*a?{left:(i+o)/2,right:"auto"}:{left:"auto",right:0}),n?t.css({top:$(document).scrollTop()+$(window).height()-r-dScrollTopHeight,bottom:"auto",position:s}).show():t.css({top:"auto",position:s}).show()};$("a.js-toreply-btn").bind("click",function(t){t.preventDefault();var e=document.getElementById("postcomments");e&&e.scrollIntoView()});var l=null;n?$(window).bind("resize scroll",function(){t.hide(),clearTimeout(l),l=setTimeout(function(){r()},300)}):$(window).bind("resize",function(){r()}),r()}function getArticleProperty(t){return jQuery("#hiddenDataBox").find("input[name='"+t+"']").val()}function initShareBox(){var t=$("#shareBox");if(t.size()){var e=$(".js_share_post"),i={shareData:{site:encodeURIComponent("天涯社区"),title:"",title_gbk:"",url:""},getPageData:function(){jQuery.extend(this.shareData,{title:encodeURIComponent("分享博文《"+getArticleProperty("PostTitle")+"》"),title_gbk:getArticleProperty("PostTitleUTF"),url:encodeURIComponent(getArticleProperty("PostUrl"))})},bindEvent:function(){var t=this;$(".js-tyweibo").bind("click",function(){if(!__global.isOnline())return void TY.loginAction();var t="bbs_share_t",e=new TY.ui.pop({headTxt:"转发到天涯微博",body:'<div id="'+t+'" style="width:600px;height:166px;">正在加载...</div>',isMod:!0,isShowButton:!1});!function(){TY.loader("TY.ui.twitterPost",function(){$("#"+t).html("");window.twitterPost=new TY.ui.twitterPost({el:$("#"+t),isCross:!0,type:"shareTweet",from:"天涯博客",appId:"blog",successTxt:"转发成功",oPostData:{appBlock:getArticleProperty("BlogID"),postId:getArticleProperty("PostID"),preUrl:getArticleProperty("PostUrl"),preTitle:getArticleProperty("PostTitle"),preUserName:getArticleProperty("UserName"),preUserId:getArticleProperty("UserID"),prePostTime:getArticleProperty("PostCreateDatetime"),sourceName:"天涯博客",sourceLink:"http://blog.tianya.cn/",type:2},plugins:"friend,emotion",twitterObj:"twitterPost",callback:function(){window.twitterPost.remove(),e.remove()}})})}()}),$(".js-sinaweibo").bind("click",function(){window.open("http://service.weibo.com/share/share.php?url="+t.shareData.url+"&title="+t.shareData.title+"&content=utf-8&ralateUid=2140585607&appkey=482040646","sw","toolbar=0,status=0,resizable=1,width=440,height=430")}),$(".js-qzone").bind("click",function(){window.open("http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url="+t.shareData.url+"&title="+t.shareData.title+"&site="+t.shareData.site,"qw","toolbar=0,status=0,resizable=1,width=600,height=480")}),$(".js-qqweibo").bind("click",function(){window.open("http://share.v.t.qq.com/index.php?c=share&a=index&url="+t.shareData.url+"&assname="+t.shareData.site+"&title="+t.shareData.title,"qw2","toolbar=0,status=0,resizable=1,width=600,height=480")}),$(".js-renren").bind("click",function(){window.open("http://share.xiaonei.com/share/buttonshare.do?link="+t.shareData.url+"&title="+t.shareData.title,"rw","toolbar=0,status=0,resizable=1,width=600,height=400")}),$(".js-tieba").bind("click",function(){window.open("http://tieba.baidu.com/f/commit/share/openShareApi?url="+t.shareData.url+"&title="+t.shareData.title_gbk,"tw","toolbar=0,status=0,resizable=1,width=600,height=400")}),$(".js-douban").bind("click",function(){window.open("http://www.douban.com/recommend/?url="+t.shareData.url+"&title="+t.shareData.title,"dw","toolbar=0,resizable=1,scrollbars=yes,status=1,width=600,height=400")}),$(".js-penyou").bind("click",function(){window.open("http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?to=pengyou&url="+t.shareData.url+"&title="+t.shareData.title+"&site="+t.shareData.site,"qw","toolbar=0,status=0,resizable=1,width=600,height=480")}),$(".js-weixin").bind("click",function(){var t=getArticleProperty("PostID");TY.loader("TY.ui.popV2",function(){var e="http://blog.tianya.cn/blog/code.jsp?postId="+t;new TY.ui.popV2({headTxt:"分享到微信朋友圈",isShowButton:!1,isShowBorder:!1,isDrag:!1,scrollable:!1,width:"240px",body:'<img class="weixin-qrcode" src=" '+e+'" /><div class="weixin_popup_foot">打开微信，点击底部的“发现”，<br>使用“扫一扫”即可将网页分享至朋友圈。</div>'})})})},init:function(){t.size()&&t.html(['<a href="javascript:void(0);" class="share-icos share-icos-1 js-tyweibo" title="分享到天涯微博">天涯微博</a>','<a href="javascript:void(0);" class="share-icos share-icos-2 js-sinaweibo" title="分享到新浪微博"></a>','<a href="javascript:void(0);" class="share-icos share-icos-3 js-qzone" title="分享到QQ空间"></a>','<a href="javascript:void(0);" class="share-icos share-icos-6 js-tieba" title="分享到百度贴吧"></a>','<a href="javascript:void(0);" class="share-icos share-icos-7 js-douban" title="分享到豆瓣网"></a>','<a href="javascript:void(0);" class="share-icos share-icos-8 js-penyou" title="分享到腾讯朋友"></a>','<a href="javascript:void(0);" class="share-icos share-icos-12 js-weixin" id="share_weixin" title="分享到微信"></a>'].join("")),e.size()&&($("body").append(['<div id="f_shareBox">','<ul class="f-selbox" class="clearfix">','<li><a href="javascript:void(0);" class="share-icos share-icos-2 js-sinaweibo">新浪微博</a></li>','<li><a href="javascript:void(0);" class="share-icos share-icos-4 js-qqweibo">腾讯微博</a></li>','<li><a href="javascript:void(0);" class="share-icos share-icos-3 js-qzone">QQ空间</a></li>','<li><a href="javascript:void(0);" class="share-icos share-icos-5 js-renren">人人网</a></li>','<li><a href="javascript:void(0);" class="share-icos share-icos-6 js-tieba">百度贴吧</a></li>','<li><a href="javascript:void(0);" class="share-icos share-icos-7 js-douban">豆瓣网</a></li>','<li><a href="javascript:void(0);" class="share-icos share-icos-8 js-penyou">腾讯朋友</a></li>','<li><a href="javascript:void(0);" class="share-icos share-icos-1 js-tyweibo">天涯微博</a></li>',"</ul>","</div>"].join("")),bindSelPosition({parent:e,box:$("#f_shareBox"),top:2,left:-36})),this.getPageData(),this.bindEvent()}};i.init()}}function popWindow(t){new TY.ui.pop({headTxt:t.title||"提示",body:t.body,type:t.type||"confirm",yesHandler:function(){t.callback&&t.callback()}})}function popTip(t){TY.loader("Qing.ui.tips",function(){new TY.ui.tips({el:t.el||null,type:t.type||"success",msg:t.msg||"操作成功",position:"midCenter",time:t.time||2500,callback:t.callback})})}function bindCommentDel(){jQuery(".articlecomments-list").delegate(".delComment","click",function(){var t=jQuery(this),e=t.closest(".articlecomments-cell"),i=getArticleProperty("BlogID"),o=getArticleProperty("PostID"),a=t.attr("data");popWindow({body:"确认删除该评论吗？",callback:function(){jQuery.ajax({url:"http://blog.tianya.cn/api/blog",cache:!1,dataType:"json",data:{"params.blogId":i,"params.postId":o,"params.commentId":a,method:"blog.ice.deleteBlogComment"},success:function(t){t&&1==t.success?(popTip({msg:"评论删除成功。"}),e.slideUp().remove()):-15==t.code?TY.loader("TY.ui.nav",function(){TY.checkLoginUser(3)}):popTip({msg:t.message||"评论删除失败。",type:"failure"})}})}})})}function bindSetBlackList(){jQuery(".add_black").click(function(){var t=jQuery(this).attr("data"),e=['<input type="text" maxlength="16" value="'+t+'" id="input_add_name" class="input_add_name" style="width:180px;height:20px;padding:5px;">','<input type="button" id="blog_black_add" class="blog_black_add" style="margin-left:30px;padding:8px 25px 8px 25px;border-radius:5px;border:none;cursor:pointer;" value="添加">','<div style="margin-top:15px;"><a href="http://www.tianya.cn/user/blacklist" style="color:#2965b1;" class="user-relative" target="_blank">编辑黑名单</a><div>'].join("");TY.loader("TY.ui.popV2",function(){new TY.ui.popV2({type:"confirm",isShowHead:!0,isShowButton:!1,isShowBorder:!1,isClickable:!0,isDrag:!1,fixed:!0,width:"320px",height:"60px",headTxt:"设置黑名单",body:e,scrollable:!0,render:function(){jQuery(".blog_black_add").click(function(){var t=jQuery("#input_add_name"),e=t.val();new TY.util.proxy({name:"tianyacnProxy",path:"http://www.tianya.cn/proxy.html"},"ajax",{url:"http://www.tianya.cn/api/tw?method=userBlack.ice.add",data:{"params.blackUserName":e},type:"post",dataType:"json",success:function(t){1==t.success?TY_Common_util.showTips("success",t.message):TY_Common_util.showTips("failure",t.message)}})})}})})})}function bindCommentAdd(){function t(){}$("#submitComment").click(function(e){e.preventDefault(),t($(this))})}function bindCommentQuote(){jQuery(".articlecomments-list").delegate(".quoteComment","click",function(){var t="-------------------------------",e=jQuery(this),i=e.closest(".articlecomments-cell"),o=i.find(".comments-content").html(),a=o.indexOf(t),n=i.find(".replyName").text(),s=i.find(".replyTime").text(),r=jQuery.find(".comments-textarea")[0];-1!==a&&(o=o.substring(a+t.length)),o=jQuery.trim(TY.util.replaceTag(o.replace(/<br>/gi,"\r\n"))),r.value="@"+n+"  "+s+"\r\n"+o+"\r\n"+t+"\r\n",r.scrollIntoView(),TY.loader("TY.util.cursorPoint",function(){TY.util.cursorPoint.toTextEnd(r)})})}function initViewPicMax(){var t={timer:null,picCollection:null,domEl:null,init:function(){this.picCollection=jQuery(".articletext .editor-pic-insert"),this.picCollection.size()>0&&(this.initDom(),this.bindEvent())},initDom:function(){this.domEl=jQuery('<a href="#" class="viewPicMax" title="打开大图" target="_blank"></a>'),jQuery(document.body).append(this.domEl)},bindEvent:function(){var t=this;this.picCollection.mouseenter(function(){clearTimeout(t.timer);var e=jQuery(this),i=e.position(),o=e.attr("src");o=o.replace(/p\/m/,"p/l"),t.domEl.attr("href",o).css({top:i.top,left:i.left+parseInt(this.width,10),display:"block"})}).mouseleave(function(){t.timer=setTimeout(function(){t.domEl.hide()},1e3)}),this.domEl.mouseenter(function(){clearTimeout(t.timer)})}};t.init()}function bindLoginAction(){jQuery(".loginToPost").click(function(){TY.loginAction()}),jQuery(".comments-textarea").click(function(){TY.loginAction()})}function bindDashangBlog(){$(".dashang-btn").click(function(){__global.isOnline()?$.getScript("http://shang.tianya.cn/api/call.do?method=shang.top.getShangSign&merId="+dashang.merId+"&merNum="+dashang.merNum+"&authorName="+dashang.getName+"&var=signInfo",function(){TY.loader("TY.ui.dashang",function(){TY.ui.dashang.init({src:"http://shang.tianya.cn/order/index.do?merId="+dashang.merId+"&merNum="+dashang.merNum+"&getName="+dashang.getName+"&time="+signInfo.data.time+"&ext1="+dashang.ext1+"&ext2="+dashang.ext2+"&ext4="+(dashang.ext4||dashang.ext3)+"&sign="+signInfo.data.sign})})}):TY.loginAction()})}function myCollect(){$(".button-my-collect").click(function(){if(__global.isOnline()){var config=$(this).data("collect");if(!config)return;if("string"==typeof config)try{eval("config = "+config)}catch(e){return}new TY.util.proxy({name:"tianyacnProxy",path:"http://www.tianya.cn/proxy.html"},"ajax",{url:"http://www.tianya.cn/api/tw?method=collect.ice.addCollectArticleByPop",data:{"params.appName":config.type,"params.title":config.title,"params.url":config.url,"params.articleUserId":config.uid,"params.articleUserName":config.uname,"params.articleTime":config.time,"params.fromUrl":config.headurl,"params.from":config.head},type:"post",dataType:"json",success:function(t){TY.loader("TY.ui.popV2",function(){new TY.ui.popV2({type:"confirm",isShowHead:!0,isShowButton:!1,isShowBorder:!1,isClickable:!0,isDrag:!1,fixed:!0,width:"300px",height:"60px",headTxt:"",body:['<h3 style="text-align:center;position:relative;color:#5d5d5d;font-weight:normal;font-size:15px;font-family:Microsoft YaHei;"><img style="margin-right:10px;position:relative;top:9px;" src="http://static.tianyaui.com/global/blog/web/static2blog/sys_template_style/images/collect-icon.png" />'+t.message+'<a class="blog-mylike" style="color:#4094c7;" target="_blank" href="http://blog.tianya.cn/blog/blog_mylike.jsp"> 查看我的收藏</a></h3>'].join(""),scrollable:!1})})}})}else TY.loginAction()})}!function(){jQuery(".blog-archive .sorttitle a").click(function(){var t=jQuery(this),e=t.parent(".sorttitle").next(),i=t.hasClass("on");return i?t.removeClass("on"):t.addClass("on"),i?e.removeClass("on"):e.addClass("on"),!1})}();var $=jQuery;jQuery(function(){bindFocusFn(),bindSendMsg(),initShareBox(),setFloatMenu(),initAdvice(),myCollect(),bindCommentAdd(),bindDashangBlog(),TY.loader("TY.util.cursorPoint",function(){bindCommentQuote()}),initViewPicMax(),__global.isOnline()?(bindCommentDel(),bindSetBlackList()):bindLoginAction()});